[Unit]
Description=DC/OS Metrics Agent: exposes node, container, and application metrics
Requires=dcos-portalocker.service
After=dcos-portalocker.service
[Service]
Restart=always
RestartSec=5
LimitNOFILE=16384
PermissionsStartOnly=True
User=dcos_metrics
SupplementaryGroups=dcos_adminrouter
EnvironmentFile=c:\opt\mesosphere\environment.export.ps1
EnvironmentFile=c:\opt\mesosphere\etc\dcos-metrics.env.ps1
EnvironmentFile=-c:\opt\mesosphere\etc\dcos-metrics-extra.env.ps1
# NOTE: bootstrap here needs access to name resolution, so needs dcos-net working
ExecStartPre=c:\opt\mesosphere\bin\scripts\bootstrap.exe dcos-metrics-agent
ExecStartPre=pwsh.exe -command  test-path c:\var\lib\dcos\cluster-id 
ExecStart=powershell.exe -command c:\opt\mesosphere\bin\dcos-metrics.exe -role agent -config $env:DCOS_METRICS_CONFIG_PATH
